<!DOCTYPE html>
<html>
<head>
<script src="/socket.io/socket.io.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.2.2/d3.v3.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="http://trifacta.github.io/vega/vega.js"></script>
<script>
var socket = io.connect('/');
var plotFile;
function updatePlot() {
    vg.parse.spec('/file/' + plotFile, function (chart) {
        chart({ el: '#vis' }).update();
    });
}
socket.on('connect', function () {
    var pathParts = window.location.pathname.split('/');
    plotFile = pathParts[pathParts.length - 1];
    socket.emit('watch', { filename: plotFile });
});
socket.on('change', function (data) {
    var filename = data.filename;
    console.log('file changed: ' + filename);
    if (filename === plotFile) {
        // Update the whole plot.
        console.log('updating plot');
        updatePlot();
    } else {
        console.log('unknown file; doing nothing');
    }
});
socket.on('error', function (data) {
    console.log('error: ' + data.message);
    $('#log').append(data.message + '<br>');
});
socket.on('ready', function (data) {
    // Draw for the first time.
    console.log('drawing initial plot');
    updatePlot();
});
</script>
</head>
<body>
    <div id="vis"></div>
    <div id="log">
    </div>
</body>
</html>
